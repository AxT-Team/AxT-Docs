---
title: 🔌 创建第一个插件
date: 2025-08-28 18:56:29
permalink: /axtbot/v2.1/develop/create-a-plugin
author:
  name: AxT-Team - Shanshui2024
  link: https://github.com/Shanshui2024
---

# 创建第一个插件
打开你的插件目录 创建一个py文件 名称随意 以下文档称创建的插件为 `example.py`

打开文件 然后填入下面这一行
``` python
__metadata__ = {
    "name": "插件名称",
    "version": "1.0.0",
    "author": "作者名",
    "description": "这是一个测试插件"
}
```
这四个都可以自行修改

这样 我们就完成了插件的开发~

## 创建插件功能
上文中 我们提到了一个`__metadata__`字段 那么这到底是什么呢？

让我们回到框架处理逻辑上

框架在启动时 会读取插件的`__metadata__`字段 并获取该插件的信息 提供该接口以方便其他插件进行管理等

这样 我们的插件市场也可以根据上面的内容进行内容构建

那么 要做成一个插件 我们就需要让他能先接收到消息

比如：我要开发一个天气插件 那么 我们可以写入以下内容：

``` python
from src.Utils.PluginBase import command
from src.Utils.EventClass import GroupMessageEvent # 注意：此处仅导入群消息事件，实际还有其他的，我们日后再说

...
# 上文的metadata字段已省略

@command(["/查天气","查天气"])
async def handler_function(event: GroupMessageEvent):
    await event.reply("正在查询天气...")
```

这样，当我们塞入 `plugins` 文件夹、重启框架，然后艾特机器人，就会发生以下情况：

```
用户：@机器人 /查天气

机器人：正在查询天气...
```

恭喜！我们已经学会了最基础的事件接受、命令注册和消息回复！

## 细节的事件处理
但是，作为一个查询天气的机器人而言，光回复一个查询天气肯定不是我们想要的

那么，我们就需要在回复之后进行消息的检查、代入API进行请求之类的

怎么做呢？我们在文件中填入以下几行：

``` python
from src.Utils.PluginBase import command
from src.Utils.EventClass import GroupMessageEvent

...
# 上文的metadata字段已省略

@command(["/查天气","查天气"])
async def handler_function(event: GroupMessageEvent):
    await event.reply("正在查询天气...") # [!code --]
    msg = event.content # [!code ++]
    msg = msg.split(" ")[1] # [!code ++]
    if msg: # [!code ++]
        await event.reply(f"您要查询的城市为：{msg}")  # [!code ++]
    else: # [!code ++]
        await event.reply("请附带要查询的城市") # [!code ++]
```

ok，此时重启框架，就会在发起命令后显示 `您要查询的城市为：xxx`

---

本例中 我们可以在代码段中看到一个 `event.content` 字段

事实上，这个字段和其他字段（例如 `event.user_id` ）都是「**消息事件**」所具有的

对于不同的消息体，我们有不同的字段，比如群聊就会有群聊OpenID，频道就会有channel_id和guild_id等

不过目前我们就先使用通用的 `event.content` 字段 获取到当前的消息串

然后 再把 `msg` 字符串进行分析，或是直接填入API接口里进行检索。这里以 「[Uapis.cn](https://uapis.cn/)」 的『[天气查询接口](https://uapis.cn/docs/api-reference/get-misc-weather)』为例，即：

``` python
import requests # 引入requests请求模块  [!code ++]
from src.Utils.PluginBase import command
from src.Utils.EventClass import GroupMessageEvent

...
# 上文的逻辑代码已省略
    if msg:
        await event.reply(f"您要查询的城市为：{msg}")
        url = f"https://uapis.cn/api/v1/misc/weather?city={msg}"# [!code ++]
        response = requests.get(url)# [!code ++]
        data = response.json()# [!code ++]
        if response.status_code == 200:# [!code ++]
            await event.reply(f"{data['city']}天气情况：{data['weather']}")# [!code ++]
    else:
        await event.reply("请附带要查询的城市")
```

此时，再次重启，我们就会得到：
```
用户：@机器人 /查天气 北京

机器人：您要查询的城市为：北京

机器人：北京天气情况：阴
```

这样，我们就完成了一个简单的事件处理逻辑。

## 实现
实际上，像这样的框架内部逻辑有很多，这些实现 例如 `event` 字段 都会在后文提到具体的字段 `attributes`